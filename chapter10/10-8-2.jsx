(function(){    // 検索したいフォルダを指定する    var folderObj = Folder.selectDialog("検索したいテキストファイルがあるフォルダを選択してください");    if (!folderObj){ return; }  // キャンセルされた場合は何も処理しない    // ファイル保存ダイアログを表示する    var saveObj = File.saveDialog("検索結果の保存先を指定してください");    if (!saveObj){ return; }    // キャンセルされた場合は何も処理しない    // 書き込めるかどうか調べる    var flag = saveObj.open("w");    if (!flag){        alert("ファイルが書き込めません");    }    var seacrhText = prompt("検索する正規表現文字列を入力してください", "\\d{3}");    if (!seacrhText){ return; } // キャンセルされた場合は何もしない    // 保存する文字コードを指定する    saveObj.encoding = "utf-8";    // 検索でヒットしたファイル数を入れる変数を用意する    var count = 0;    searchText(folderObj)    // 検索でヒットしたファイル数を書き出す    saveObj.writeln("--------------------");    saveObj.writeln("検索キーワード："+seacrhText);    saveObj.writeln("検索でヒットしたファイル数："+count);    alert("終了しました");    // フォルダ内のテキストファイルを検索する関数    function searchText(folderObj){        // ファイル/フォルダ一覧を取得する        var fileList = folderObj.getFiles("*.txt");        // ファイルの数だけ読み出す        for(var i=0; i<fileList.length; i++){            // 正規表現で検索を行う            var flag = fileList[i].open("r");   // ファイルを読み込みモードで開く            if (flag == true){  // 開くのに成功した場合は以後の処理を行う                var text = fileList[i].read();  // 全部読み込む                fileList[i].close();    // ファイルを閉じる                var p = text.match(new RegExp(seacrhText));   // 正規表現で検索する                if (p != null){    // 見つかった場合はnull以外になる                    try{    // ファイル名に%が含まれるとエラになるので回避                        var filename = decodeURI(fileList[i].fsName);                    }catch(e){                        var filename = fileList[i].fsName;                    }                    saveObj.writeln(filename);    // ファイル名を保存する                    count = count + 1;  // カウントする                }            }        }        // フォルダを含めた一覧を取得する        fileList = folderObj.getFiles();        for(var i=0; i<fileList.length; i++){            // フォルダかどうか調べる            if(fileList[i].getFiles){                makeList(fileList[i]);  // フォルダの場合は再帰呼び出し            }        }    }})();